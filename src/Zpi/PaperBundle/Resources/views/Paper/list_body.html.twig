{% from 'ZpiPaperBundle:Review:macro.html.twig' import show_status %}
{% from 'ZpiPaperBundle:Paper:macro.html.twig' import show_type %}

{# definicja stałych potrzebna do określenia statusu pracy #}
{% set MARK_NO_MARK = constant('Zpi\\PaperBundle\\Entity\\Review::MARK_NO_MARK') %}
{% set MARK_ACCEPTED = constant('Zpi\\PaperBundle\\Entity\\Review::MARK_ACCEPTED') %}
{% set MARK_CONDITIONALLY_ACCEPTED = constant('Zpi\\PaperBundle\\Entity\\Review::MARK_CONDITIONALLY_ACCEPTED') %}
{% set MARK_REJECTED = constant('Zpi\\PaperBundle\\Entity\\Review::MARK_REJECTED') %}

{% block js %}
<script type="text/javascript" src="{{ asset('jquery-1.6.3.js') }}"></script>
<script>
$(document).ready(function () {
	$('button.upload').click(function() {
			document.location.href = $(this).attr('href');
		});
    $('button#edit').click(function() {
			document.location.href = $(this).attr('href');
		});    
    $('button#delete').click(function() {
			document.location.href = $(this).attr('href');
		});    
    {#$('button#details').click(function() {
			document.location.href = $(this).attr('href');
		});    #}
});
</script>
{% endblock %}

{% for paper in papers %}
	{% set authors = paper.authors2 %}
	{% set doc = paper.lastDocument() %}
<tr>
        <td>   
	
        {{ paper.title }}
        </td>
         
        <td>
        {% if(doc != '') %}
        v.{{ doc.version }}
        {% else %}
        -
        {% endif %} 
        </td>
        <td>            
        <div id="inner_content" style="display:none;">
    	<p>
        {{ paper.abstract | nl2br }}
        </p>
        </div>
        <a href="#inner_content" rel="ibox&width=600" title="Paper's abstract">{% trans %}paper.abstract.show{% endtrans %}</a>
        </td>
        <td> 
		{% for author in authors %}{{ author.name }} {{ author.surname | upper}}<br> {% endfor %}
        </td>
        <td>
        {{ show_type(paper) }}
        </td>
        <td>
        {% if(doc != '') %}
            <a href="{{ path('review_show', { 'doc_id': doc.id }) }}">       
            {{ show_status(paper.status) }}</a>
        {% else %}
            {% trans %}reg.confirm.nonsubmitted_papers{% endtrans %}
        {% endif %}
        </td>
        <td>
            <a href="{{ path(path_details, { 'id': paper.id }) }}">{% trans %}paper.list.details{% endtrans %}</a>
        </td>
        
        <td class="buttons">
            
		     
        {% if edit and paper.owner.id == app.user.id %}
            <button href="{{ path('document_upload', { 'id': paper.id }) }}" class="upload"{% if not (paper.canUpload(registration)) %} disabled{% endif %}>
            {% trans %}paper.details.upload{% endtrans %}</button><br>
            <button id="edit" href="{{ path('paper_edit', { 'id': paper.id }) }}">{% trans %}paper.list.edit{% endtrans %}</button><br>
            {#<button id="details" href="{{ path(path_details, { 'id': paper.id }) }}">{% trans %}paper.list.details{% endtrans %}</button><br>#}
            <button id="delete" href="{{path('paper_delete',{'id': registration.id, 'paper_id' : paper.id})}}">{{'paper.delete' | trans}}</button><br>            
            {#<a href="{{path('paper_delete',{'id': registration.id, 'paper_id' : paper.id})}}">{{'paper.delete' | trans}} </a>#}
        {% else %}{# pozostawiam linka details dla listy review #}
            <a href="{{ path(path_details, { 'id': paper.id }) }}">{% trans %}paper.list.details{% endtrans %}</a>
        {% endif %}
		{% if manage %} | <a href="{{ path('conference_manage_assign_editors', { 'paper_id': paper.id }) }}">
            {% trans %}conf.manage.papers_assign_editors{% endtrans %}</a> |
        <a href="{{ path('conference_manage_papers_deadline', { 'paper_id': paper.id }) }}">
	        {% trans %}conf.manage.papers_deadline{% endtrans %}</a>
        <form novalidate="novalidate" action="{{ path('send_notificatione_email') }}" method="POST">
	<input type="submit" value="{% trans %}conf.manage.send.notification.email{% endtrans %}" />
	</form>
        {% endif %}
        
	
      </td>
{#   
    <td>
        {% if edit and paper.owner.id == app.user.id %}
            {% if not paper.isSubmitted() %}
            {% trans %}reg.confirm.nonsubmitted_papers{% endtrans %}
            {% elseif paper.getStatus() == MARK_NO_MARK %}
            {% trans %}reg.confirm.waiting_papers{% endtrans %}
            {% elseif paper.getStatus() == MARK_ACCEPTED %}
            {% trans %}reg.confirm.accepted_papers{% endtrans %}
            {% elseif paper.getStatus() == MARK_CONDITIONALLY_ACCEPTED %}
            {% trans %}reg.confirm.reg.confirm.cond_accepted_papers{% endtrans %}
            {% elseif paper.getStatus() == MARK_REJECTED %}
            {% trans %}reg.confirm.nonaccepted_papers{% endtrans %}
            {% endif %}
        {% endif %}
    </td>
#}
    </tr>
{% else %}
	<p>{% trans %}paper.list.empty{% endtrans %}</p>
{% endfor %}

